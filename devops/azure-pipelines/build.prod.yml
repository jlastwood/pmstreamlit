# specific path build
trigger:
  branches:
    include:
    - master
  paths:
    exclude:
    - devops/azure-pipelines/build.base.yml
    - devops/docker/Dockerfile.base
    - requirements.txt

pool:
  vmImage: 'Ubuntu-16.04'
variables:
  dockerFile: 'devops/docker/Dockerfile.prod'
  dockerRegistry: 'dockerhub-awesome-streamlit'
  imageName: 'marcskovmadsen/awesome-streamlit'
  buildContext: $(System.DefaultWorkingDirectory)

steps:
- task: Docker@2
  displayName: Login to Docker Hub
  inputs:
    command: login
    containerRegistry: $(dockerRegistry)
- task: Docker@2
  displayName: Build and Push
  inputs:
    command: buildAndPush
    repository: $(imageName)
    dockerFile: $(dockerFile)
    defaultContext: False
    context: $(buildContext)
    tags: |
      $(Build.BuildId)
      latest